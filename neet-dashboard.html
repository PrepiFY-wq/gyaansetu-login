<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NEET Dashboard - GyaanSetu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      color: white;
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 { font-size: 26px; }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
    }

    .logout-btn {
      background: rgba(255,255,255,0.15);
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.6);
      cursor: pointer;
      font-size: 13px;
    }

    .logout-btn:hover { background: rgba(255,255,255,0.25); }

    .container {
      max-width: 1400px;
      margin: 25px auto 40px;
      padding: 0 20px;
    }

    .section-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 2px 12px rgba(15,23,42,0.06);
      margin-bottom: 25px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .section-header h2 {
      font-size: 18px;
      color: #111827;
    }

    .section-header span {
      font-size: 12px;
      color: #6b7280;
    }

    /* Countdown */
    .exam-countdown {
      background: linear-gradient(135deg, #f97316 0%, #ef4444 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      margin-bottom: 25px;
    }

    .exam-countdown h2 { font-size: 22px; margin-bottom: 10px; }

    .exam-subtitle {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 15px;
    }

    .countdown-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
      margin: 15px 0 10px;
    }

    .countdown-item {
      background: rgba(255,255,255,0.15);
      padding: 12px;
      border-radius: 10px;
      text-align: center;
    }

    .countdown-item .number {
      font-size: 28px;
      font-weight: 700;
    }

    .countdown-item .label {
      font-size: 13px;
      opacity: 0.9;
    }

    .quote {
      font-style: italic;
      margin-top: 10px;
      font-size: 14px;
      opacity: 0.96;
    }

    /* Update progress */
    .update-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }

    .update-box {
      background: #f9fafb;
      border-radius: 12px;
      padding: 14px 16px;
      border: 1px solid #e5e7eb;
    }

    .update-box label {
      display: block;
      margin-bottom: 6px;
      color: #4b5563;
      font-size: 13px;
      font-weight: 600;
    }

    .update-box input {
      width: 100%;
      padding: 9px 11px;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
      font-size: 14px;
    }

    .update-box input:focus {
      outline: none;
      border-color: #ec4899;
      box-shadow: 0 0 0 3px rgba(236,72,153,0.15);
    }

    .update-actions {
      display: flex;
      align-items: flex-end;
      justify-content: flex-start;
    }

    .btn {
      padding: 11px 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      color: white;
      text-decoration: none;
      display: inline-block;
    }

    .btn:hover {
      box-shadow: 0 8px 18px rgba(236,72,153,0.35);
      transform: translateY(-1px);
    }

    /* Telegram style button */
    .btn-telegram {
      background: linear-gradient(135deg, #0088cc 0%, #005fa3 100%);
      padding: 12px 20px;
      font-size: 15px;
      text-align: center;
      width: 100%;
    }

    .btn-telegram:hover {
      box-shadow: 0 8px 18px rgba(0,136,204,0.35);
    }

    /* Totals cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
    }

    .stat-card {
      background: white;
      padding: 16px 18px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(15,23,42,0.06);
      border-left: 4px solid #ec4899;
    }

    .stat-card h3 {
      color: #4b5563;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
    }

    .stat-card .number {
      font-size: 26px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 4px;
    }

    .stat-card .meta {
      font-size: 12px;
      color: #6b7280;
    }

    .empty-state {
      text-align: center;
      padding: 28px 10px;
      color: #9ca3af;
      font-size: 13px;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .list-item {
      font-size: 13px;
      color: #111827;
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #fee2e2;
      color: #b91c1c;
      margin-left: 6px;
    }

    /* Community & Help */
    .community-help-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
    }

    .community-box {
      background: linear-gradient(135deg, #0088cc 0%, #005fa3 100%);
      color: white;
      padding: 22px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,136,204,0.2);
    }

    .community-box h3 {
      font-size: 16px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .community-box p {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .help-box {
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      color: white;
      padding: 22px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(236,72,153,0.25);
    }

    .help-box h3 {
      font-size: 16px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .help-box p {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 8px;
      line-height: 1.5;
    }

    .help-box .email {
      font-size: 14px;
      font-weight: 600;
      margin-top: 10px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.15);
      border-radius: 8px;
      word-break: break-all;
    }

    .help-box .email a {
      color: white;
      text-decoration: none;
    }

    .help-box .email a:hover {
      text-decoration: underline;
    }

    @media (max-width: 640px) {
      .header {
        padding: 16px 18px;
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .container {
        padding: 0 14px;
      }
    }
  </style>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyFiEVyWCStmdOxaSz2AAboplrOXAJn0XuW614KRzLihSL60qL8zy3GEgBVvm0DQPcmQg/exec';

    // NEET folder links (Drive – account B)
    const NEET_FOLDER_LINKS = {
      mockTests:     'https://drive.google.com/drive/folders/1S6jXk2DjkQrz18DkzLe7mE96LTgfJF82',
      pyqPapers:     'https://drive.google.com/drive/folders/1_gmpV6arJev-2f3GqNruW9GlLTifb0Pz',
      books:         'https://drive.google.com/drive/folders/1escuk7ilmtykvUnYeK0tYS-33yLY7N_M',
      diagrams:      'https://drive.google.com/drive/folders/156IrNxBiQkVSGbmXM_WZYCuohiwJr2F2',
      notesPdfs:     'https://drive.google.com/drive/folders/1Pddoss5g262eD8k7ECP_PJ6uBtJYcY-W'
    };

    // Access guard: only logged-in NEET users
    (function guardAccess() {
      const exam = localStorage.getItem('exam');
      const userId = localStorage.getItem('userId');

      if (!exam || !userId || exam !== 'NEET') {
        window.location.href = 'index.html';
      }
    })();
  </script>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <h1>NEET Dashboard</h1>
    <div class="header-right">
      <span id="userName">Welcome</span>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="container">
    <!-- COUNTDOWN -->
    <section class="exam-countdown">
      <h2>NEET UG 2026</h2>
      <div class="exam-subtitle">
        Har roz ka focused study aapko ek seat ke kareeb le jaata hai.
      </div>
      <div class="countdown-grid">
        <div class="countdown-item">
          <div class="number" id="daysLeft">0</div>
          <div class="label">Days Left</div>
        </div>
        <div class="countdown-item">
          <div class="number" id="hoursLeft">0</div>
          <div class="label">Hours Left</div>
        </div>
      </div>
      <div class="quote" id="dailyQuote">
        Every focused study session today becomes confidence inside the exam hall.
      </div>
    </section>

    <!-- UPDATE DAILY PROGRESS -->
    <section class="section-card">
      <div class="section-header">
        <h2>Update Your Daily Progress</h2>
        <span>Track your NEET preparation honestly</span>
      </div>
      <form id="progressForm" onsubmit="updateProgress(event)">
        <div class="update-grid">
          <div class="update-box">
            <label for="studyHours">Study Hours Today</label>
            <input type="number" id="studyHours" min="0" step="0.5" placeholder="e.g. 6" required>
          </div>
          <div class="update-box">
            <label for="topicsCovered">Topics Covered Today</label>
            <input type="number" id="topicsCovered" min="0" step="1" placeholder="Chapters/Topics" required>
          </div>
          <div class="update-box">
            <label for="mockTests">Questions / Tests</label>
            <input type="number" id="mockTests" min="0" step="1" placeholder="MCQs or tests count" required>
          </div>
          <div class="update-box update-actions">
            <button type="submit" class="btn">Save & Add to Totals</button>
          </div>
        </div>
      </form>
    </section>

    <!-- OVERALL TOTALS -->
    <section class="section-card">
      <div class="section-header">
        <h2>Overall Progress Totals</h2>
        <span>Calculated from your daily entries</span>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Study Hours</h3>
          <div class="number" id="totalHours">0</div>
          <div class="meta">Physics · Chemistry · Biology combined</div>
        </div>
        <div class="stat-card">
          <h3>Topics Covered</h3>
          <div class="number" id="totalTopics">0</div>
          <div class="meta">Important topics across PCB</div>
        </div>
        <div class="stat-card">
          <h3>Questions / Tests</h3>
          <div class="number" id="totalTests">0</div>
          <div class="meta">MCQs attempted / tests taken</div>
        </div>
      </div>
    </section>

    <!-- ANNOUNCEMENTS -->
    <section class="section-card">
      <div class="section-header">
        <h2>Announcements</h2>
        <span>NEET related updates from admin</span>
      </div>
      <div id="announcements">
        <div class="empty-state">No announcements yet. Admin will update here.</div>
      </div>
    </section>

    <!-- TEST PORTAL -->
    <section class="section-card">
      <div class="section-header">
        <h2>Test Portal</h2>
        <span>Mock Tests · Previous Year Questions</span>
      </div>

      <h3 style="font-size: 15px; color:#4b5563; margin-bottom:8px;">Mock Tests</h3>
      <div id="testSeriesList">
        <div class="empty-state">Admin will upload mock tests soon.</div>
      </div>

      <h3 style="font-size: 15px; color:#4b5563; margin:20px 0 8px;">Previous Year Questions (PYQs)</h3>
      <div id="pypList">
        <div class="empty-state">Admin will upload PYQ PDFs soon.</div>
      </div>
    </section>

    <!-- STUDY MATERIALS -->
    <section class="section-card">
      <div class="section-header">
        <h2>Study Materials</h2>
        <span>NCERT · Reference Books · Notes</span>
      </div>

      <h3 style="font-size: 15px; color:#4b5563; margin-bottom:8px;">Books</h3>
      <div id="booksList">
        <div class="empty-state">Admin will upload books list soon.</div>
      </div>

      <h3 style="font-size: 15px; color:#4b5563; margin:20px 0 8px;">Important Diagrams / Charts</h3>
      <div id="formulaList">
        <div class="empty-state">Admin will upload diagrams & charts soon.</div>
      </div>

      <h3 style="font-size: 15px; color:#4b5563; margin:20px 0 8px;">Notes & PDFs</h3>
      <div id="notesList">
        <div class="empty-state">Admin will upload notes & PDFs soon.</div>
      </div>
    </section>

    <!-- PATH PRADARSHAK -->
    <section class="section-card">
      <div class="section-header">
        <h2>पथ प्रदर्शक</h2>
        <span>Daily motivation for NEET aspirants</span>
      </div>
      <div id="motivationalQuotes">
        <div class="empty-state">Admin will share motivational quotes soon.</div>
      </div>
    </section>

    <!-- COMMUNITY & HELP -->
    <section class="section-card">
      <div class="section-header">
        <h2>Community & Help</h2>
        <span>Discussions · Interaction · Support</span>
      </div>
      <div class="community-help-grid">
        <div class="community-box">
          <h3>Join for discussions and interaction</h3>
          <p>
            NEET aspirants ke liye dedicated group jahan doubts, strategy aur test discussion daily ho sakta hai.
          </p>
          <a
            href="https://t.me/+IjZVPQ9AIu1jMDU9"
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn-telegram"
          >
            Join NEET Telegram Group
          </a>
        </div>
        <div class="help-box">
          <h3>Contact for queries</h3>
          <p>
            Dashboard, content ya kisi bhi feature se related query ke liye email se contact karein.
          </p>
          <div class="email">
            Mail us at
            <a href="mailto:gyaansetu2026@gmail.com">gyaansetu2026@gmail.com</a>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Daily NEET-focused quotes
    const neetQuotes = [
      'Every NCERT page revised today reduces panic on exam day.',
      'Strong concepts plus repeated MCQs is the real NEET strategy.',
      'Solve one more biology diagram, one more physics numericals, one more chemistry reaction.',
      'Consistency in small chapters creates big ranks in NEET.',
      'You are not competing with others, you are competing with your yesterday.'
    ];

    function loadDailyQuote() {
      const todayKey = new Date().toISOString().slice(0, 10);
      const stored = localStorage.getItem('neetQuote');
      let quote;

      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          if (parsed.date === todayKey) {
            quote = parsed.text;
          }
        } catch (e) {}
      }

      if (!quote) {
        quote = neetQuotes[Math.floor(Math.random() * neetQuotes.length)];
        localStorage.setItem('neetQuote', JSON.stringify({ date: todayKey, text: quote }));
      }

      document.getElementById('dailyQuote').textContent = quote;
    }

    // Fixed countdown (example values)
    function updateCountdown() {
      document.getElementById('daysLeft').textContent  = 120;
      document.getElementById('hoursLeft').textContent = 2868;
    }

    function logout() {
      if (confirm('Logout from GyaanSetu?')) {
        localStorage.removeItem('userId');
        localStorage.removeItem('name');
        localStorage.removeItem('exam');
        window.location.href = 'index.html';
      }
    }

    // STUDY PROGRESS: logStudy + getStudyTotals
    function updateProgress(e) {
      e.preventDefault();

      const userId = localStorage.getItem('userId');
      const exam   = localStorage.getItem('exam');

      if (!userId || !exam) {
        alert('Session expired. Please login again.');
        window.location.href = 'index.html';
        return;
      }

      const hours  = parseFloat(document.getElementById('studyHours').value) || 0;
      const topics = parseInt(document.getElementById('topicsCovered').value || '0', 10);
      const mocks  = parseInt(document.getElementById('mockTests').value || '0', 10);

      const url = `${SCRIPT_URL}?action=logStudy`
                + `&userId=${encodeURIComponent(userId)}`
                + `&exam=${encodeURIComponent(exam)}`
                + `&hours=${encodeURIComponent(hours)}`
                + `&topics=${encodeURIComponent(topics)}`
                + `&mocks=${encodeURIComponent(mocks)}`;

      fetch(url)
        .then(r => r.json())
        .then(data => {
          if (!data.success) {
            throw new Error(data.message || 'Failed to save study log');
          }
          const totalsUrl = `${SCRIPT_URL}?action=getStudyTotals`
                          + `&userId=${encodeURIComponent(userId)}`
                          + `&exam=${encodeURIComponent(exam)}`;
          return fetch(totalsUrl).then(r => r.json());
        })
        .then(totals => {
          if (totals && totals.success) {
            document.getElementById('totalHours').textContent  = totals.totalHours || 0;
            document.getElementById('totalTopics').textContent = totals.totalTopics || 0;
            document.getElementById('totalTests').textContent  = totals.totalMocks || 0;
          }
          alert('Progress updated successfully!');
          document.getElementById('progressForm').reset();
        })
        .catch(err => {
          console.error('Update progress error:', err);
          alert('Error updating progress. Please try again.');
        });
    }

    function loadTotals() {
      const userId = localStorage.getItem('userId');
      const exam   = localStorage.getItem('exam');
      if (!userId || !exam) return;

      const totalsUrl = `${SCRIPT_URL}?action=getStudyTotals`
                      + `&userId=${encodeURIComponent(userId)}`
                      + `&exam=${encodeURIComponent(exam)}`;

      fetch(totalsUrl)
        .then(r => r.json())
        .then(totals => {
          if (totals && totals.success) {
            document.getElementById('totalHours').textContent  = totals.totalHours || 0;
            document.getElementById('totalTopics').textContent = totals.totalTopics || 0;
            document.getElementById('totalTests').textContent  = totals.totalMocks || 0;
          }
        })
        .catch(err => console.error('Load totals error:', err));
    }

    // Announcements
    function renderAnnouncements(items) {
      const container = document.getElementById('announcements');
      container.innerHTML = '';
      if (!items || !items.length) {
        container.innerHTML = '<div class="empty-state">No announcements yet. Admin will update here.</div>';
        return;
      }

      const list = document.createElement('div');
      list.className = 'list';
      items.forEach((it, index) => {
        const row = document.createElement('div');
        row.className = 'list-item';
        row.textContent = typeof it === 'string' ? it : (it.text || it.title || '');
        if (index === 0) {
          row.style.fontWeight = '600';
          row.style.background = '#eef2ff';
          row.style.borderRadius = '6px';
          row.style.padding = '6px 8px';
          const tag = document.createElement('span');
          tag.className = 'tag';
          tag.textContent = 'NEW';
          row.appendChild(tag);
        }
        list.appendChild(row);
      });
      container.appendChild(list);
    }

    // Folder View button renderer
    function renderFolderButton(containerId, folderUrl, emptyMessage) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      if (!folderUrl) {
        container.innerHTML = `<div class="empty-state">${emptyMessage || 'No data yet.'}</div>`;
        return;
      }
      const btn = document.createElement('button');
      btn.className = 'btn';
      btn.textContent = 'View';
      btn.onclick = () => window.open(folderUrl, '_blank');
      container.appendChild(btn);
    }

    // Motivational quotes (from backend sheet)
    function renderQuotesList(containerId, items) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      if (!items || !items.length) {
        container.innerHTML = '<div class="empty-state">Admin will share motivational quotes soon.</div>';
        return;
      }
      const list = document.createElement('div');
      list.className = 'list';
      items.forEach(q => {
        const row = document.createElement('div');
        row.className = 'list-item';
        row.textContent = typeof q === 'string' ? q : (q.text || q.title || '');
        list.appendChild(row);
      });
      container.appendChild(list);
    }

    // Dashboard content (only announcements + quotes from backend)
    function loadNeetDashboardContent() {
      const url = `${SCRIPT_URL}?action=getDashboardContent&examType=NEET`;

      fetch(url)
        .then(r => r.json())
        .then(data => {
          if (!data || !data.success || !data.payload) return;
          const p = data.payload;

          if (p.announcements && Array.isArray(p.announcements.items)) {
            renderAnnouncements(p.announcements.items);
          }

          if (p.quotes && Array.isArray(p.quotes.items) && p.quotes.items.length) {
            renderQuotesList('motivationalQuotes', p.quotes.items);
          }
        })
        .catch(err => console.error('loadNeetDashboardContent error:', err));

      // Static folder buttons – always visible
      renderFolderButton(
        'testSeriesList',
        NEET_FOLDER_LINKS.mockTests,
        'Admin will upload mock tests soon.'
      );

      renderFolderButton(
        'pypList',
        NEET_FOLDER_LINKS.pyqPapers,
        'Admin will upload PYQ PDFs soon.'
      );

      renderFolderButton(
        'booksList',
        NEET_FOLDER_LINKS.books,
        'Admin will upload books list soon.'
      );

      renderFolderButton(
        'formulaList',
        NEET_FOLDER_LINKS.diagrams,
        'Admin will upload diagrams & charts soon.'
      );

      renderFolderButton(
        'notesList',
        NEET_FOLDER_LINKS.notesPdfs,
        'Admin will upload notes & PDFs soon.'
      );
    }

    window.onload = function() {
      document.getElementById('userName').textContent =
        localStorage.getItem('name') || 'Candidate';

      updateCountdown();
      loadDailyQuote();
      loadTotals();
      loadNeetDashboardContent();
    };
  </script>
</body>
</html>
