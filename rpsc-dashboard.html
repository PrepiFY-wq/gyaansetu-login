<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RPSC Dashboard - GyaanSetu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 { font-size: 26px; }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
    }

    .logout-btn {
      background: rgba(255,255,255,0.15);
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.6);
      cursor: pointer;
      font-size: 13px;
    }

    .logout-btn:hover { background: rgba(255,255,255,0.25); }

    .container {
      max-width: 1400px;
      margin: 25px auto 40px;
      padding: 0 20px;
    }

    .section-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 2px 12px rgba(15,23,42,0.06);
      margin-bottom: 25px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .section-header h2 {
      font-size: 18px;
      color: #111827;
    }

    .section-header span {
      font-size: 12px;
      color: #6b7280;
    }

    /* Countdown */
    .exam-countdown {
      background: linear-gradient(135deg, #6366f1 0%, #0ea5e9 100%);
      color: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      margin-bottom: 25px;
    }

    .exam-countdown h2 {
      font-size: 22px;
      margin-bottom: 10px;
    }

    .exam-subtitle {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 15px;
    }

    .countdown-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 15px;
      margin: 15px 0 10px;
    }

    .countdown-item {
      background: rgba(255,255,255,0.15);
      padding: 12px;
      border-radius: 10px;
      text-align: center;
    }

    .countdown-item .title {
      font-size: 13px;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .countdown-item .number {
      font-size: 22px;
      font-weight: 700;
    }

    .countdown-item .label {
      font-size: 12px;
      opacity: 0.9;
    }

    .quote {
      font-style: italic;
      margin-top: 10px;
      font-size: 14px;
      opacity: 0.96;
    }

    /* Update progress */
    .update-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }

    .update-box {
      background: #f9fafb;
      border-radius: 12px;
      padding: 14px 16px;
      border: 1px solid #e5e7eb;
    }

    .update-box label {
      display: block;
      margin-bottom: 6px;
      color: #4b5563;
      font-size: 13px;
      font-weight: 600;
    }

    .update-box input {
      width: 100%;
      padding: 9px 11px;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
      font-size: 14px;
    }

    .update-box input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
    }

    .update-actions {
      display: flex;
      align-items: flex-end;
      justify-content: flex-start;
    }

    .btn {
      padding: 11px 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      text-decoration: none;
      display: inline-block;
    }

    .btn:hover {
      box-shadow: 0 8px 18px rgba(59,130,246,0.35);
      transform: translateY(-1px);
    }

    .btn-telegram {
      background: linear-gradient(135deg, #0088cc 0%, #005fa3 100%);
      padding: 14px 24px;
      font-size: 15px;
      width: 100%;
      text-align: center;
    }

    .btn-telegram:hover {
      box-shadow: 0 8px 18px rgba(0,136,204,0.35);
    }

    /* Totals cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
    }

    .stat-card {
      background: white;
      padding: 16px 18px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(15,23,42,0.06);
      border-left: 4px solid #3b82f6;
    }

    .stat-card h3 {
      color: #4b5563;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
    }

    .stat-card .number {
      font-size: 26px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 4px;
    }

    .stat-card .meta {
      font-size: 12px;
      color: #6b7280;
    }

    .empty-state {
      text-align: center;
      padding: 28px 10px;
      color: #9ca3af;
      font-size: 13px;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .list-item {
      font-size: 13px;
      color: #111827;
      padding: 8px;
      background: #f9fafb;
      border-radius: 6px;
      border-left: 3px solid #3b82f6;
    }

    .list-item.new {
      background: #e0edff;
      font-weight: 600;
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #fca5a5;
      color: #7f1d1d;
      margin-left: 6px;
      font-weight: 600;
    }

    .material-section {
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e5e7eb;
    }

    .material-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .material-section h3 {
      font-size: 15px;
      color: #4b5563;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .btn-folder {
      display: inline-block;
      padding: 10px 20px;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }

    .btn-folder:hover {
      box-shadow: 0 8px 18px rgba(59,130,246,0.35);
      transform: translateY(-1px);
    }

    /* Community & Help Section */
    .community-help-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .community-box {
      background: linear-gradient(135deg, #0088cc 0%, #005fa3 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,136,204,0.2);
    }

    .community-box h3 {
      font-size: 16px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .community-box p {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .community-box .btn-telegram {
      margin-top: 10px;
    }

    .help-box {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(16,185,129,0.2);
    }

    .help-box h3 {
      font-size: 16px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .help-box p {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 8px;
      line-height: 1.5;
    }

    .help-box .email {
      font-size: 14px;
      font-weight: 600;
      margin-top: 10px;
      padding: 12px;
      background: rgba(255,255,255,0.15);
      border-radius: 8px;
      word-break: break-all;
    }

    .help-box .email a {
      color: white;
      text-decoration: none;
    }

    .help-box .email a:hover {
      text-decoration: underline;
    }

    @media (max-width: 640px) {
      .header {
        padding: 16px 18px;
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .container {
        padding: 0 14px;
      }
      .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .community-help-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyFiEVyWCStmdOxaSz2AAboplrOXAJn0XuW614KRzLihSL60qL8zy3GEgBVvm0DQPcmQg/exec';

    // RPSC folder links (Drive – account B)
    const RPSC_FOLDER_LINKS = {
      testSeries:  'https://drive.google.com/drive/folders/11X-00tsQAVPbfLkYB2E00idYPRE85dyq?usp=sharing',
      pyqPapers:   'https://drive.google.com/drive/folders/1DXZRKwh0cbAt5qq4hCX-pp7YCWBw3InN?usp=sharing',
      books:       'https://drive.google.com/drive/folders/1WIyjXfe5_FFH6a-4B4ttaVuiR5I2V2vN?usp=sharing',
      chartsMaps:  'https://drive.google.com/drive/folders/1LJHQrMVnKIINewJC-EK2rPWDgFiQzkwQ?usp=sharing',
      notesPdfs:   'https://drive.google.com/drive/folders/1tw30jBEB9vKKoRrITrNfXa_kzj-wIdyk?usp=sharing',
      otherState:  'https://drive.google.com/drive/folders/1OcmyTEx74vik5fNQJqGgEIm_ClRZB3QD?usp=sharing'
    };

    // RPSC-focused quotes
    const rpscQuotes = [
      'Aaj likhi gayi har answer practice, kal Mains copy par clarity banegi.',
      'Classroom me khade hone ka sapna, aaj ke disciplined self-study se poora hoga.',
      'Rajasthan GK ka ek-ek page aapko interview panel ke sawalon se bachata hai.',
      'Jo candidate roj thoda likhta hai, wahi paper me pura likh paata hai.',
      'Ek extra mock test aaj, merit list me ek extra step upar kal.'
    ];

    // Access guard: only logged-in RPSC users
    (function guardAccess() {
      const exam = localStorage.getItem('exam');
      const userId = localStorage.getItem('userId');

      if (!exam || !userId || exam !== 'RPSC') {
        window.location.href = 'index.html';
      }
    })();

    function loadDailyQuote() {
      const todayKey = new Date().toISOString().slice(0, 10);
      const stored = localStorage.getItem('rpscQuote');
      let quote;

      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          if (parsed.date === todayKey) {
            quote = parsed.text;
          }
        } catch (e) {}
      }

      if (!quote) {
        quote = rpscQuotes[Math.floor(Math.random() * rpscQuotes.length)];
        localStorage.setItem('rpscQuote', JSON.stringify({ date: todayKey, text: quote }));
      }

      document.getElementById('dailyQuote').textContent = quote;
    }

    // Countdown (placeholder fixed values – aage jaake dynamic date se nikal sakte ho)
    function updateCountdown() {
      document.getElementById('daysRas').textContent = 168;
      document.getElementById('daysG1').textContent = 148;
      document.getElementById('daysG2').textContent = 190;
    }

    function logout() {
      if (confirm('Logout from GyaanSetu?')) {
        localStorage.removeItem('userId');
        localStorage.removeItem('name');
        localStorage.removeItem('exam');
        window.location.href = 'index.html';
      }
    }

    // STUDY PROGRESS
    function updateProgress(e) {
      e.preventDefault();

      const userId = localStorage.getItem('userId');
      const exam = localStorage.getItem('exam');

      if (!userId || !exam) {
        alert('Session expired. Please login again.');
        window.location.href = 'index.html';
        return;
      }

      const hours = parseFloat(document.getElementById('studyHours').value) || 0;
      const topics = parseInt(document.getElementById('topicsCovered').value || '0', 10);
      const mocks = parseInt(document.getElementById('mockTests').value || '0', 10);

      const url = `${SCRIPT_URL}?action=logStudy`
        + `&userId=${encodeURIComponent(userId)}`
        + `&exam=${encodeURIComponent(exam)}`
        + `&hours=${encodeURIComponent(hours)}`
        + `&topics=${encodeURIComponent(topics)}`
        + `&mocks=${encodeURIComponent(mocks)}`;

      fetch(url)
        .then(r => r.json())
        .then(data => {
          if (!data.success) {
            throw new Error(data.message || 'Failed to save study log');
          }
          const totalsUrl = `${SCRIPT_URL}?action=getStudyTotals`
            + `&userId=${encodeURIComponent(userId)}`
            + `&exam=${encodeURIComponent(exam)}`;
          return fetch(totalsUrl).then(r => r.json());
        })
        .then(totals => {
          if (totals && totals.success) {
            document.getElementById('totalHours').textContent = totals.totalHours || 0;
            document.getElementById('totalTopics').textContent = totals.totalTopics || 0;
            document.getElementById('totalTests').textContent = totals.totalMocks || 0;
          }
          alert('Progress updated successfully!');
          document.getElementById('progressForm').reset();
        })
        .catch(err => {
          console.error('Update progress error:', err);
          alert('Error updating progress. Please try again.');
        });
    }

    function loadTotals() {
      const userId = localStorage.getItem('userId');
      const exam = localStorage.getItem('exam');
      if (!userId || !exam) return;

      const totalsUrl = `${SCRIPT_URL}?action=getStudyTotals`
        + `&userId=${encodeURIComponent(userId)}`
        + `&exam=${encodeURIComponent(exam)}`;

      fetch(totalsUrl)
        .then(r => r.json())
        .then(totals => {
          if (totals && totals.success) {
            document.getElementById('totalHours').textContent = totals.totalHours || 0;
            document.getElementById('totalTopics').textContent = totals.totalTopics || 0;
            document.getElementById('totalTests').textContent = totals.totalMocks || 0;
          }
        })
        .catch(err => console.error('Load totals error:', err));
    }

    // Announcements
    function renderAnnouncements(items) {
      const container = document.getElementById('announcements');
      container.innerHTML = '';
      if (!items || !items.length) {
        container.innerHTML = '<div class="empty-state">No announcements yet. Admin will update here.</div>';
        return;
      }

      const list = document.createElement('div');
      list.className = 'list';
      items.forEach((it, index) => {
        const row = document.createElement('div');
        row.className = 'list-item';
        if (index === 0) {
          row.classList.add('new');
        }
        row.textContent = typeof it === 'string' ? it : (it.text || it.title || '');
        if (index === 0) {
          const tag = document.createElement('span');
          tag.className = 'tag';
          tag.textContent = 'NEW';
          row.appendChild(tag);
        }
        list.appendChild(row);
      });
      container.appendChild(list);
    }

    // Folder View button renderer
    function renderFolderButton(containerId, folderUrl, emptyMessage) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      if (!folderUrl) {
        container.innerHTML = `<div class="empty-state">${emptyMessage || 'No data yet.'}</div>`;
        return;
      }
      const btn = document.createElement('button');
      btn.className = 'btn-folder';
      btn.textContent = 'View Folder';
      btn.onclick = () => window.open(folderUrl, '_blank');
      container.appendChild(btn);
    }

    // Motivational quotes from backend
    function renderQuotesList(containerId, items) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      if (!items || !items.length) {
        container.innerHTML = '<div class="empty-state">Admin will share motivational quotes soon.</div>';
        return;
      }
      const list = document.createElement('div');
      list.className = 'list';
      items.forEach(q => {
        const row = document.createElement('div');
        row.className = 'list-item';
        row.textContent = typeof q === 'string' ? q : (q.text || q.title || '');
        list.appendChild(row);
      });
      container.appendChild(list);
    }

    // Dashboard content (only announcements + quotes from backend)
    function loadRpscDashboardContent() {
      const url = `${SCRIPT_URL}?action=getDashboardContent&examType=RPSC`;

      fetch(url)
        .then(r => r.json())
        .then(data => {
          if (!data || !data.success || !data.payload) return;
          const p = data.payload;

          if (p.announcements && Array.isArray(p.announcements.items)) {
            renderAnnouncements(p.announcements.items);
          }

          if (p.quotes && Array.isArray(p.quotes.items) && p.quotes.items.length) {
            renderQuotesList('motivationalQuotes', p.quotes.items);
          }
        })
        .catch(err => console.error('loadRpscDashboardContent error:', err));

      // Static folder buttons – always visible
      renderFolderButton(
        'testSeriesList',
        RPSC_FOLDER_LINKS.testSeries,
        'Admin will upload mock tests soon.'
      );

      renderFolderButton(
        'pypList',
        RPSC_FOLDER_LINKS.pyqPapers,
        'Admin will upload PYQ PDFs soon.'
      );

      renderFolderButton(
        'booksList',
        RPSC_FOLDER_LINKS.books,
        'Admin will upload books list soon.'
      );

      renderFolderButton(
        'formulaList',
        RPSC_FOLDER_LINKS.chartsMaps,
        'Admin will upload charts & maps soon.'
      );

      renderFolderButton(
        'notesList',
        RPSC_FOLDER_LINKS.notesPdfs,
        'Admin will upload notes & PDFs soon.'
      );

      renderFolderButton(
        'otherStateList',
        RPSC_FOLDER_LINKS.otherState,
        'Admin will upload other state exams material soon.'
      );
    }

    window.onload = function() {
      document.getElementById('userName').textContent =
        localStorage.getItem('name') || 'Candidate';

      updateCountdown();
      loadDailyQuote();
      loadTotals();
      loadRpscDashboardContent();
    };
  </script>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <h1>RPSC Dashboard</h1>
    <div class="header-right">
      <span id="userName">Welcome</span>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <div class="container">
    <!-- COUNTDOWN: RAS Pre, 1st Grade, 2nd Grade -->
    <section class="exam-countdown">
      <h2>RPSC Exams 2026</h2>
      <div class="exam-subtitle">
        Roz ka disciplined study aapko agle RPSC panel ke saamne confident khada karta hai.
      </div>
      <div class="countdown-grid">
        <div class="countdown-item">
          <div class="title">RAS Pre 2026</div>
          <div class="number" id="daysRas">0</div>
          <div class="label">Days Left</div>
        </div>
        <div class="countdown-item">
          <div class="title">1st Grade 2026</div>
          <div class="number" id="daysG1">0</div>
          <div class="label">Days Left</div>
        </div>
        <div class="countdown-item">
          <div class="title">2nd Grade 2026</div>
          <div class="number" id="daysG2">0</div>
          <div class="label">Days Left</div>
        </div>
      </div>
      <div class="quote" id="dailyQuote">
        Aaj ka ek extra revision page, kal interview board ke saamne extra confidence banega.
      </div>
    </section>

    <!-- UPDATE DAILY PROGRESS -->
    <section class="section-card">
      <div class="section-header">
        <h2>Update Your Daily Progress</h2>
        <span>Track your RPSC preparation honestly</span>
      </div>
      <form id="progressForm" onsubmit="updateProgress(event)">
        <div class="update-grid">
          <div class="update-box">
            <label for="studyHours">Study Hours Today</label>
            <input type="number" id="studyHours" min="0" step="0.5" placeholder="e.g. 6" required>
          </div>
          <div class="update-box">
            <label for="topicsCovered">Topics Covered Today</label>
            <input type="number" id="topicsCovered" min="0" step="1" placeholder="Chapters/Topics" required>
          </div>
          <div class="update-box">
            <label for="mockTests">Questions / Tests</label>
            <input type="number" id="mockTests" min="0" step="1" placeholder="MCQs or tests count" required>
          </div>
          <div class="update-box update-actions">
            <button type="submit" class="btn">Save & Add to Totals</button>
          </div>
        </div>
      </form>
    </section>

    <!-- OVERALL TOTALS -->
    <section class="section-card">
      <div class="section-header">
        <h2>Overall Progress Totals</h2>
        <span>Calculated from your daily entries</span>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Study Hours</h3>
          <div class="number" id="totalHours">0</div>
          <div class="meta">GS · Rajasthan GK · Optional combined</div>
        </div>
        <div class="stat-card">
          <h3>Topics Covered</h3>
          <div class="number" id="totalTopics">0</div>
          <div class="meta">Syllabus units completed</div>
        </div>
        <div class="stat-card">
          <h3>Questions / Tests</h3>
          <div class="number" id="totalTests">0</div>
          <div class="meta">MCQs / test papers attempted</div>
        </div>
      </div>
    </section>

    <!-- ANNOUNCEMENTS -->
    <section class="section-card">
      <div class="section-header">
        <h2>Announcements</h2>
        <span>RPSC related updates from admin</span>
      </div>
      <div id="announcements">
        <div class="empty-state">No announcements yet. Admin will update here.</div>
      </div>
    </section>

    <!-- TEST PORTAL -->
    <section class="section-card">
      <div class="section-header">
        <h2>Test Portal</h2>
        <span>Mock Tests · Previous Year Questions</span>
      </div>

      <div class="material-section">
        <h3>Mock Tests (RPSC Focused)</h3>
        <div id="testSeriesList">
          <div class="empty-state">Admin will upload mock tests soon.</div>
        </div>
      </div>

      <div class="material-section">
        <h3>Previous Year Questions (PYQs)</h3>
        <div id="pypList">
          <div class="empty-state">Admin will upload PYQ PDFs soon.</div>
        </div>
      </div>
    </section>

    <!-- STUDY MATERIALS -->
    <section class="section-card">
      <div class="section-header">
        <h2>Study Materials</h2>
        <span>Standard books · Rajasthan specific notes</span>
      </div>

      <div class="material-section">
        <h3>Books</h3>
        <div id="booksList">
          <div class="empty-state">Admin will upload books list soon.</div>
        </div>
      </div>

      <div class="material-section">
        <h3>Important Charts / Maps</h3>
        <div id="formulaList">
          <div class="empty-state">Admin will upload charts & maps soon.</div>
        </div>
      </div>

      <div class="material-section">
        <h3>Notes & PDFs</h3>
        <div id="notesList">
          <div class="empty-state">Admin will upload notes & PDFs soon.</div>
        </div>
      </div>

      <div class="material-section">
        <h3>Other State Exams (For Practice)</h3>
        <div id="otherStateList">
          <div class="empty-state">Admin will upload other state exams material soon.</div>
        </div>
      </div>
    </section>

    <!-- PATH PRADARSHAK -->
    <section class="section-card">
      <div class="section-header">
        <h2>पथ प्रदर्शक</h2>
        <span>Daily motivation for RPSC aspirants</span>
      </div>
      <div id="motivationalQuotes">
        <div class="empty-state">Admin will share motivational quotes soon.</div>
      </div>
    </section>

    <!-- COMMUNITY & HELP -->
    <section class="section-card">
      <div class="section-header">
        <h2>Community & Help</h2>
        <span>Telegram group · Support</span>
      </div>
      <div class="community-help-grid">
        <div class="community-box">
          <h3>Join GyaanSetu RPSC Community</h3>
          <p>
            Doubt poochne, answer writing review, aur daily motivation ke liye
            official Telegram group join karein.
          </p>
          <a
            href="https://t.me/your_rpsc_group_link"
            target="_blank"
            rel="noopener noreferrer"
            class="btn btn-telegram"
          >
            Join Telegram Group
          </a>
        </div>
        <div class="help-box">
          <h3>Need Help?</h3>
          <p>Login, dashboard ya content se related koi bhi issue ho to mail karein.</p>
          <p>Response time usually 24 hours ke andar.</p>
          <div class="email">
            <a href="mailto:support@gyaansetu.in">support@gyaansetu.in</a>
          </div>
        </div>
      </div>
    </section>
  </div>
</body>
</html>
