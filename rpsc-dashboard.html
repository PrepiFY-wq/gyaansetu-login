<main class="col-12 col-md-9 col-lg-10 px-4 py-3">
  <!-- Top bar -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
    <div>
      <h4 class="mb-1">
        Welcome back, <span id="userNameHeader">RPSC Aspirant</span>
      </h4>
      <div class="text-muted small">
        Consistent answer writing and revision crack <strong>RAS</strong> & Teaching services.
      </div>
    </div>
    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-outline-secondary btn-sm" onclick="logout()">
        <i class="bi bi-box-arrow-right me-1"></i> Logout
      </button>
      <div
        class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
        style="width: 36px; height: 36px"
      >
        <span class="small fw-semibold">YOU</span>
      </div>
    </div>
  </div>

  <!-- COUNTDOWN + QUOTE -->
  <section class="rpsc-card p-3 mb-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <div>
        <h5 class="mb-0">RPSC Exam Countdown</h5>
        <div class="small text-muted">
          RAS Pre, 1st Grade & 2nd Grade – plan your months wisely.
        </div>
      </div>
    </div>

    <div class="row g-3 mb-3">
      <div class="col-12 col-md-4">
        <div class="border rounded p-3 h-100 text-center">
          <div class="small text-muted mb-1">RAS Prelims 2026</div>
          <div class="fs-4 fw-semibold" id="rasDaysLeft">0</div>
          <div class="small text-muted">Days Left</div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="border rounded p-3 h-100 text-center">
          <div class="small text-muted mb-1">RPSC 1st Grade</div>
          <div class="fs-4 fw-semibold" id="firstGradeDaysLeft">0</div>
          <div class="small text-muted">Days Left</div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="border rounded p-3 h-100 text-center">
          <div class="small text-muted mb-1">RPSC 2nd Grade</div>
          <div class="fs-4 fw-semibold" id="secondGradeDaysLeft">0</div>
          <div class="small text-muted">Days Left</div>
        </div>
      </div>
    </div>

    <div class="border rounded p-3 bg-light">
      <div class="small text-primary fw-semibold mb-1">
        आज का मोटिवेशन (RPSC Quote of the Day)
      </div>
      <div id="dailyQuoteRpsc" class="small">
        जो आज जवाब लिखने की आदत बना रहा है, वही कल RAS और शिक्षक बनकर जवाबदेही निभाएगा।
      </div>
    </div>
  </section>

  <!-- DAILY PROGRESS INPUT -->
  <section class="rpsc-card p-3 mb-3" id="daily-progress">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Update Your Daily Progress</h5>
      <span class="small text-muted">
        RAS, 1st Grade & 2nd Grade preparation tracker
      </span>
    </div>

    <form id="dailyProgressFormRpsc" class="row g-3" onsubmit="updateProgressRpsc(event)">
      <div class="col-12 col-md-4">
        <label class="form-label small fw-semibold">Study Hours Today</label>
        <input
          type="number"
          min="0"
          step="0.5"
          class="form-control"
          id="inputStudyHoursRpsc"
          placeholder="e.g. 6"
          required
        />
      </div>
      <div class="col-12 col-md-4">
        <label class="form-label small fw-semibold">Topics Covered Today</label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          id="inputTopicsCoveredRpsc"
          placeholder="e.g. 4"
          required
        />
      </div>
      <div class="col-12 col-md-4">
        <label class="form-label small fw-semibold">Mock Tests Completed</label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          id="inputMocksCompletedRpsc"
          placeholder="e.g. 1"
          required
        />
      </div>

      <div class="col-12">
        <button type="submit" class="btn btn-primary btn-sm mt-1">
          <i class="bi bi-check2-circle me-1"></i> Save & Add to Totals
        </button>
      </div>
    </form>
  </section>

  <!-- TOTALS -->
  <section class="rpsc-card p-3 mb-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Overall Progress Totals</h5>
      <span class="small text-muted">Updated from daily entries</span>
    </div>
    <div class="row g-3">
      <div class="col-12 col-md-4">
        <div class="border rounded p-3 h-100">
          <div class="small text-muted mb-1">Total Study Hours</div>
          <h4 class="mb-1" id="totalStudyHoursRpsc">0</h4>
          <div class="small text-muted">
            RAS · 1st Grade · 2nd Grade
          </div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="border rounded p-3 h-100">
          <div class="small text-muted mb-1">Total Topics Covered</div>
          <h4 class="mb-1" id="totalTopicsCoveredRpsc">0</h4>
          <div class="small text-muted">
            Rajasthan GK, GS, Pedagogy, Subjects
          </div>
        </div>
      </div>
      <div class="col-12 col-md-4">
        <div class="border rounded p-3 h-100">
          <div class="small text-muted mb-1">Total Mock Tests</div>
          <h4 class="mb-1" id="totalMocksCompletedRpsc">0</h4>
          <div class="small text-muted">
            RAS / 1st Grade / 2nd Grade papers
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ANNOUNCEMENTS -->
  <section class="rpsc-card p-3 mb-3" id="announcements">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Announcements</h5>
      <span class="small text-muted">
        Admin updates; visible in candidate profile
      </span>
    </div>
    <div id="announcementsListRpsc">
      <div class="text-center text-muted small py-3">
        Admin will post RPSC announcements here.
      </div>
    </div>
  </section>

  <!-- TESTS: PYQs + Mock PDFs -->
  <section class="rpsc-card p-3 mb-3" id="tests">
    <h5 class="mb-3">Tests</h5>
    <div class="row g-3">
      <!-- PYQs -->
      <div class="col-12 col-lg-6">
        <div class="border rounded p-3 h-100">
          <div class="d-flex justify-content-between mb-2">
            <h6 class="mb-0">PYQs</h6>
            <span class="small text-muted">RAS · 1st Grade · 2nd Grade</span>
          </div>
          <div id="pyqListRpsc">
            <div class="text-center text-muted small py-3">
              PYQ PDFs will appear here.
            </div>
          </div>
        </div>
      </div>

      <!-- Mock Tests PDFs -->
      <div class="col-12 col-lg-6">
        <div class="border rounded p-3 h-100">
          <div class="d-flex justify-content-between mb-2">
            <h6 class="mb-0">Mock Tests PDFs</h6>
            <span class="small text-muted">Offline practice papers</span>
          </div>
          <div id="mockPdfListRpsc">
            <div class="text-center text-muted small py-3">
              Mock test PDFs will appear here.
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- STUDY MATERIAL -->
  <section class="rpsc-card p-3 mb-3" id="study-material">
    <h5 class="mb-3">Study Material</h5>
    <div class="row g-3">
      <!-- Books -->
      <div class="col-12 col-lg-6">
        <div class="border rounded p-3 h-100">
          <div class="d-flex justify-content-between mb-2">
            <h6 class="mb-0">Books</h6>
            <span class="small text-muted">RAS · 1st Grade · 2nd Grade</span>
          </div>
          <div id="booksListRpsc">
            <div class="text-center text-muted small py-3">
              Books list will appear here.
            </div>
          </div>
        </div>
      </div>

      <!-- PDFs, Notes, etc. -->
      <div class="col-12 col-lg-6">
        <div class="border rounded p-3 h-100">
          <div class="d-flex justify-content-between mb-2">
            <h6 class="mb-0">PDFs, Notes & Others</h6>
            <span class="small text-muted">Uploaded by admin</span>
          </div>
          <div id="notesListRpsc">
            <div class="text-center text-muted small py-3">
              Important PDFs and notes will appear here.
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- पथ प्रदर्शक -->
  <section class="rpsc-card p-3 mb-3" id="path-pradarshak">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">पथ प्रदर्शक</h5>
      <span class="small text-muted">
        Daily motivation for RAS & Teaching services
      </span>
    </div>
    <div id="pathPradarshakRpsc">
      <div class="border rounded p-3 bg-light">
        <p class="small mb-2">
          “जो आज पढ़ कर खुद को बदल रहा है, वही कल कक्षा और प्रशासन दोनों में
          बदलाव लाएगा। RAS हो या 1st / 2nd Grade, आपकी मेहनत बच्चों और समाज का
          भविष्य तय करेगी।”
        </p>
        <p class="small mb-0">
          रोज़ थोड़ा लिखें, थोड़ा पढ़ें, थोड़ा दोहराएँ। तीनों परीक्षाओं के लिए
          आधार एक ही है – मजबूत <strong>आत्मअनुशासन</strong> और निरंतरता।
        </p>
      </div>
    </div>
  </section>
</main>

<script>
  // Daily RPSC quote [web:170]
  const rpscQuotes = [
    'आज की answer-writing आपकी कल की प्रशासनिक ताकत है।',
    'हर दिन थोड़ा Rajasthan GK, थोड़ा GS, थोड़ा लिखना – यही RAS का रास्ता है।',
    'किताबें और नोट्स आपकी ढाल हैं, निरंतरता आपकी तलवार।',
    'RAS और Teaching दोनों के लिए एक ही मंत्र: रोज़ बैठो, रोज़ लिखो, रोज़ सुधारो।',
    'जो syllabus को पहले समझता है, वही attempt को सही तरह से इस्तेमाल करता है।'
  ];

  function loadDailyQuoteRpsc() {
    const todayKey = new Date().toISOString().slice(0, 10);
    const stored = localStorage.getItem('rpscQuote');
    let quote;
    if (stored) {
      const parsed = JSON.parse(stored);
      if (parsed.date === todayKey) quote = parsed.text;
    }
    if (!quote) {
      quote = rpscQuotes[Math.floor(Math.random() * rpscQuotes.length)];
      localStorage.setItem('rpscQuote', JSON.stringify({ date: todayKey, text: quote }));
    }
    document.getElementById('dailyQuoteRpsc').textContent = quote;
  }

  // Countdown for three exams (tentative dates – update when official) [web:167]
  function updateRpscCountdowns() {
    const now = new Date();

    const rasPreDate = new Date('2026-02-15T09:00:00');
    const firstGradeDate = new Date('2026-03-15T09:00:00');
    const secondGradeDate = new Date('2026-04-15T09:00:00');

    const rasDays = Math.max(0, Math.floor((rasPreDate - now) / (1000 * 60 * 60 * 24)));
    const firstDays = Math.max(0, Math.floor((firstGradeDate - now) / (1000 * 60 * 60 * 24)));
    const secondDays = Math.max(0, Math.floor((secondGradeDate - now) / (1000 * 60 * 60 * 24)));

    document.getElementById('rasDaysLeft').textContent = rasDays;
    document.getElementById('firstGradeDaysLeft').textContent = firstDays;
    document.getElementById('secondGradeDaysLeft').textContent = secondDays;
  }

  function logout() {
    if (confirm('Logout from GyaanSetu?')) {
      localStorage.removeItem('userId');
      localStorage.removeItem('name');
      localStorage.removeItem('exam');
      window.location.href = 'index.html';
    }
  }

  // Study progress backend pattern [web:169][web:178]
  function updateProgressRpsc(e) {
    e.preventDefault();

    const userId = localStorage.getItem('userId');
    const exam = localStorage.getItem('exam'); // should be "RPSC"

    if (!userId || !exam) {
      alert('Session expired. Please login again.');
      window.location.href = 'index.html';
      return;
    }

    const hours =
      parseFloat(document.getElementById('inputStudyHoursRpsc').value) || 0;
    const topics =
      parseInt(
        document.getElementById('inputTopicsCoveredRpsc').value || '0',
        10
      ) || 0;
    const mocks =
      parseInt(
        document.getElementById('inputMocksCompletedRpsc').value || '0',
        10
      ) || 0;

    const url =
      `${SCRIPT_URL}?action=logStudy` +
      `&userId=${encodeURIComponent(userId)}` +
      `&exam=${encodeURIComponent(exam)}` +
      `&hours=${encodeURIComponent(hours)}` +
      `&topics=${encodeURIComponent(topics)}` +
      `&mocks=${encodeURIComponent(mocks)}`;

    fetch(url)
      .then((r) => r.json())
      .then((data) => {
        if (!data.success) {
          throw new Error(data.message || 'Failed to save study log');
        }
        const totalsUrl =
          `${SCRIPT_URL}?action=getStudyTotals` +
          `&userId=${encodeURIComponent(userId)}` +
          `&exam=${encodeURIComponent(exam)}`;
        return fetch(totalsUrl).then((r) => r.json());
      })
      .then((totals) => {
        if (totals && totals.success) {
          document.getElementById('totalStudyHoursRpsc').textContent =
            totals.totalHours || 0;
          document.getElementById('totalTopicsCoveredRpsc').textContent =
            totals.totalTopics || 0;
          document.getElementById('totalMocksCompletedRpsc').textContent =
            totals.totalMocks || 0;
        }
        alert('Progress updated successfully!');
        document.getElementById('dailyProgressFormRpsc').reset();
      })
      .catch((err) => {
        console.error('Update progress error:', err);
        alert('Error updating progress. Please try again.');
      });
  }

  function loadTotalsRpsc() {
    const userId = localStorage.getItem('userId');
    const exam = localStorage.getItem('exam');
    if (!userId || !exam) return;

    const totalsUrl =
      `${SCRIPT_URL}?action=getStudyTotals` +
      `&userId=${encodeURIComponent(userId)}` +
      `&exam=${encodeURIComponent(exam)}`;

    fetch(totalsUrl)
      .then((r) => r.json())
      .then((totals) => {
        if (totals && totals.success) {
          document.getElementById('totalStudyHoursRpsc').textContent =
            totals.totalHours || 0;
          document.getElementById('totalTopicsCoveredRpsc').textContent =
            totals.totalTopics || 0;
          document.getElementById('totalMocksCompletedRpsc').textContent =
            totals.totalMocks || 0;
        }
      })
      .catch((err) => console.error('Load totals error:', err));
  }

  window.onload = function () {
    document.getElementById('userNameHeader').textContent =
      localStorage.getItem('name') || 'RPSC Aspirant';

    updateRpscCountdowns();
    setInterval(updateRpscCountdowns, 60 * 60 * 1000);

    loadDailyQuoteRpsc();
    loadTotalsRpsc();
  };
</script>
